--1.11.2022
ALTER TABLE shopping_cart_item  ADD UNIQUE (cart_id, book_id);


--4.11.2022
ALTER TABLE bookstore.countries ADD country_id varchar(3) NOT NULL;
ALTER TABLE bookstore.books ALTER COLUMN publication_year TYPE smallint USING publication_year::smallint;
ALTER TABLE bookstore.books ADD author_id int NOT NULL;
ALTER TABLE bookstore.books ADD CONSTRAINT books_fk FOREIGN KEY (id) REFERENCES bookstore.authors(id) ON UPDATE CASCADE;

CREATE TABLE bookstore.authors (
	id int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	first_name varchar(50) NOT NULL,
	last_name varchar(50) NOT NULL,
	CONSTRAINT authors_pk PRIMARY KEY (id)
);


--9.11.2022
ALTER TABLE bookstore.shopping_cart_item ADD quantity int NOT NULL;


--11.11.2022
ALTER TABLE bookstore.customer_addresses DROP CONSTRAINT fk_address_id;
ALTER TABLE bookstore.customer_addresses ADD CONSTRAINT fk_address_id FOREIGN KEY (address_id) REFERENCES bookstore.addresses(id) ON DELETE CASCADE ON UPDATE CASCADE;


--12.11.2022
ALTER TABLE bookstore.shopping_cart_item ADD price int NOT NULL;
ALTER TABLE bookstore.shopping_cart_item ADD total_price int NULL;

--14.11.2022
ALTER TABLE bookstore.order_line RENAME COLUMN price TO total_price;
ALTER TABLE bookstore.shop_order DROP CONSTRAINT fk_address_id;
ALTER TABLE bookstore.shop_order RENAME COLUMN address_id TO customer_address_id;
ALTER TABLE bookstore.shop_order ADD CONSTRAINT shop_order_fk FOREIGN KEY (customer_address_id) REFERENCES bookstore.customer_addresses(id) ON UPDATE CASCADE;
ALTER TABLE bookstore.shop_order DROP COLUMN quantity;
ALTER TABLE bookstore.shop_order RENAME COLUMN total_price TO final_price;


--18.11.2022
ALTER TABLE bookstore.order_line RENAME TO order_item;
ALTER SEQUENCE bookstore.shop_order_id_seq RENAME TO order_item_id_seq;


--20.11.2022
ALTER TABLE bookstore.shopping_cart DROP CONSTRAINT fk_customer_id;
ALTER TABLE bookstore.shopping_cart ADD CONSTRAINT fk_customer_id FOREIGN KEY (customer_id) REFERENCES bookstore.customers(id) ON DELETE CASCADE ON UPDATE CASCADE;

--23.12.2022
ALTER TABLE bookstore.books ADD page_number int NULL;
ALTER TABLE bookstore.books ADD description text NULL;


--16.02.2023
ALTER TABLE bookstore.addresses DROP CONSTRAINT fk_country;
ALTER TABLE bookstore.addresses DROP COLUMN country_id;
ALTER TABLE bookstore.shop_order DROP CONSTRAINT shop_order_fk;
ALTER TABLE bookstore.shop_order DROP COLUMN customer_address_id;


--03.03.2023
ALTER TABLE bookstore.customers ADD isVerified bool NOT NULL DEFAULT false;
ALTER TABLE bookstore.customers ADD verification_string varchar NULL;

