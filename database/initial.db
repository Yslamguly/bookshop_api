CREATE TABLE bookstore.addresses (
	id int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	address_line varchar(255) NULL,
	city varchar(255) NOT NULL,
	region varchar(255) NOT NULL,
	postal_code varchar(255) NOT NULL,
	country_id int4 NOT NULL,
	CONSTRAINT addresses_pkey PRIMARY KEY (id),
	CONSTRAINT fk_country FOREIGN KEY (country_id) REFERENCES bookstore.countries(id) ON DELETE CASCADE
);
CREATE TABLE bookstore.books (
	id int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	isbn varchar(255) NOT NULL,
	author varchar(255) NOT NULL,
	title varchar(255) NOT NULL,
	publication_year date NULL,
	quantity_in_stock int4 NOT NULL,
	buying_price int4 NOT NULL,
	selling_price int4 NOT NULL,
	image varchar(255) NULL,
	CONSTRAINT books_pkey PRIMARY KEY (id),
	CONSTRAINT customers_isbn_key UNIQUE (isbn)
);
CREATE TABLE bookstore.categories (
	id int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	category_name varchar(25) NOT NULL,
	CONSTRAINT categories_pkey PRIMARY KEY (id)
);
CREATE TABLE bookstore.countries (
	id int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	country_name varchar(60) NOT NULL,
	CONSTRAINT countries_pkey PRIMARY KEY (id)
);
CREATE TABLE bookstore.customer_addresses (
	customer_id int4 NOT NULL,
	address_id int4 NOT NULL,
	id int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	CONSTRAINT customer_addresses_pk PRIMARY KEY (id),
	CONSTRAINT fk_address_id FOREIGN KEY (address_id) REFERENCES bookstore.addresses(id) ON DELETE CASCADE,
	CONSTRAINT fk_customer_id FOREIGN KEY (customer_id) REFERENCES bookstore.customers(id) ON DELETE CASCADE
);
CREATE TABLE bookstore.customers (
	id int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	first_name varchar(50) NOT NULL,
	last_name varchar(50) NOT NULL,
	phone_number varchar(25) NOT NULL,
	email_address varchar(50) NOT NULL,
	"password" varchar(255) NOT NULL,
	CONSTRAINT customers_phone_number_key UNIQUE (phone_number),
	CONSTRAINT customers_pkey1 PRIMARY KEY (id),
	CONSTRAINT email_address_key UNIQUE (email_address)
);
CREATE TABLE bookstore.order_line (
	id int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	shop_order_id int4 NOT NULL,
	book_id int4 NOT NULL,
	price int4 NOT NULL,
	quantity int4 NOT NULL,
	CONSTRAINT shop_order_pkey PRIMARY KEY (id),
	CONSTRAINT fk_book_id FOREIGN KEY (book_id) REFERENCES bookstore.books(id) ON DELETE CASCADE,
	CONSTRAINT fk_shop_order_id FOREIGN KEY (shop_order_id) REFERENCES bookstore.shop_order(id) ON DELETE CASCADE
);
CREATE TABLE bookstore.shop_order (
	id int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	customer_id int4 NOT NULL,
	order_date date NOT NULL,
	total_price int4 NOT NULL,
	quantity int4 NOT NULL,
	address_id int4 NOT NULL,
	CONSTRAINT shop_order_pkey1 PRIMARY KEY (id),
	CONSTRAINT fk_address_id FOREIGN KEY (address_id) REFERENCES bookstore.addresses(id) ON UPDATE CASCADE,
	CONSTRAINT fk_customer_id FOREIGN KEY (customer_id) REFERENCES bookstore.customers(id) ON UPDATE CASCADE
);
CREATE TABLE bookstore.shopping_cart (
	id int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	customer_id int4 NOT NULL,
	date_created date NOT NULL,
	CONSTRAINT shopping_cart_pkey PRIMARY KEY (id),
	CONSTRAINT fk_customer_id FOREIGN KEY (customer_id) REFERENCES bookstore.customers(id) ON UPDATE CASCADE
);
CREATE TABLE bookstore.shopping_cart_item (
	id int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	cart_id int4 NOT NULL,
	book_id int4 NOT NULL,
	CONSTRAINT shopping_cart_item_pkey PRIMARY KEY (id),
	CONSTRAINT fk_book_id FOREIGN KEY (book_id) REFERENCES bookstore.books(id) ON UPDATE CASCADE,
	CONSTRAINT fk_cart_id FOREIGN KEY (cart_id) REFERENCES bookstore.shopping_cart(id) ON UPDATE CASCADE
);
CREATE TABLE bookstore.book_category (
	id int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	book_id int4 NOT NULL,
	category_id int4 NOT NULL,
	CONSTRAINT book_category_pk PRIMARY KEY (id),
	CONSTRAINT book_category_fk FOREIGN KEY (book_id) REFERENCES bookstore.books(id) ON UPDATE CASCADE,
	CONSTRAINT book_category_fk_1 FOREIGN KEY (category_id) REFERENCES bookstore.categories(id) ON UPDATE CASCADE
);
